{"timestamp": "2026-02-09T06:32:43.824320Z", "step": "CHAT_REQUEST_RECEIVED", "message": "Chat /generate request received", "business_client_id": "default", "workspace_id": "main", "user_id": "u123", "query": "hi"}
{"timestamp": "2026-02-09T06:32:43.834005Z", "step": "CHAT_BUSINESS_FOUND", "message": "Business resolved", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55"}
{"timestamp": "2026-02-09T06:32:43.863962Z", "step": "CHAT_WORKSPACE_FOUND", "message": "Workspace resolved", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5"}
{"timestamp": "2026-02-09T06:32:43.886383Z", "step": "CHAT_CONFIG_FOUND", "message": "Workspace config loaded", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "chat_model": "gpt-4.1-mini"}
{"timestamp": "2026-02-09T06:32:43.909835Z", "step": "CHAT_QUERY_RECEIVED", "message": "Query received in system", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5", "user_id": "u123", "query": "hi", "query_word_count": 1}
{"timestamp": "2026-02-09T06:32:43.939826Z", "step": "CHAT_EMBEDDING_START", "message": "Creating query embedding", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "use_local": true}
{"timestamp": "2026-02-09T06:32:49.528246Z", "step": "CHAT_EMBEDDING_DONE", "message": "Query vector created", "vector_dim": 384, "vector_preview": [-0.090476, 0.04044, 0.023906, 0.058948, -0.022882, -0.04722, 0.045048, 0.015786]}
{"timestamp": "2026-02-09T06:32:49.540209Z", "step": "CHAT_RETRIEVAL_START", "message": "Searching RAG for matching chunks", "top_k": 5, "similarity_threshold": 0.2}
{"timestamp": "2026-02-09T06:32:49.566451Z", "step": "CHAT_RETRIEVAL_DONE", "message": "Matched 0 chunks", "chunk_count": 0, "chunk_ids": [], "chunks_matched": []}
{"timestamp": "2026-02-09T06:32:49.579237Z", "step": "CHAT_PROMPT_BUILT", "message": "Final prompt assembled for ChatGPT API", "system_prompt_len": 53, "context_len": 0, "user_content_len": 23, "prompt_preview": "[SYSTEM]\nYou are a medical assistant. Provide concise answers.\n[USER]\nCONTEXT:\n\n\nQUESTION:\nhi"}
{"timestamp": "2026-02-09T06:32:49.595120Z", "step": "CHAT_OPENAI_CALL", "message": "Calling ChatGPT API (model=gpt-4.1-mini)", "model": "gpt-4.1-mini", "temperature": 0.2, "max_tokens": 600, "message_count": 2, "request_content_len": 76}
{"timestamp": "2026-02-09T06:32:49.611179Z", "step": "CHAT_OPENAI_KEY_CHECK", "message": "OpenAI API key from env/settings (masked)", "key_set": true, "key_length": 164, "masked_key": "sk-proj...YFkA"}
{"timestamp": "2026-02-09T06:32:49.643554Z", "step": "CHAT_OPENAI_SEND", "message": "Sending request to OpenAI", "model": "gpt-4.1-mini", "base_url": "https://api.openai.com/v1", "request_body": "{\"model\": \"gpt-4.1-mini\", \"message_count\": 2, \"temperature\": 0.2, \"max_tokens\": 600, \"message_content_lens\": [53, 23]}"}
{"timestamp": "2026-02-09T06:32:50.695875Z", "step": "CHAT_OPENAI_API_RESPONSE", "message": "OpenAI API raw response (before raise_for_status)", "status_code": 200, "response_body": "{\n  \"id\": \"chatcmpl-D7F79QTBxa176dvrLE0NGd6b37O1H\",\n  \"object\": \"chat.completion\",\n  \"created\": 1770618767,\n  \"model\": \"gpt-4.1-mini-2025-04-14\",\n  \"choices\": [\n    {\n      \"index\": 0,\n      \"message\": {\n        \"role\": \"assistant\",\n        \"content\": \"Hello! How can I assist you with your medical questions today?\",\n        \"refusal\": null,\n        \"annotations\": []\n      },\n      \"logprobs\": null,\n      \"finish_reason\": \"stop\"\n    }\n  ],\n  \"usage\": {\n    \"prompt_tokens\": 27,\n    \"completion_tokens\": 13,\n    \"total_tokens\": 40,\n    \"prompt_tokens_details\": {\n      \"cached_tokens\": 0,\n      \"audio_tokens\": 0\n    },\n    \"completion_tokens_details\": {\n      \"reasoning_tokens\": 0,\n      \"audio_tokens\": 0,\n      \"accepted_prediction_tokens\": 0,\n      \"rejected_prediction_tokens\": 0\n    }\n  },\n  \"service_tier\": \"default\",\n  \"system_fingerprint\": \"fp_75546bd1a7\"\n}\n"}
{"timestamp": "2026-02-09T06:32:50.708952Z", "step": "CHAT_OPENAI_RAW_RESPONSE", "message": "OpenAI API raw response body (success)", "raw_response": "{\"id\": \"chatcmpl-D7F79QTBxa176dvrLE0NGd6b37O1H\", \"object\": \"chat.completion\", \"created\": 1770618767, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you with your medical questions today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 13, \"total_tokens\": 40, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T06:32:50.738374Z", "step": "CHAT_OPENAI_RESPONSE", "message": "GPT response received", "answer_preview": "Hello! How can I assist you with your medical questions today?", "full_answer": "Hello! How can I assist you with your medical questions today?", "answer_len": 62, "prompt_tokens": 27, "completion_tokens": 13, "total_tokens": 40, "raw_response": "{\"id\": \"chatcmpl-D7F79QTBxa176dvrLE0NGd6b37O1H\", \"object\": \"chat.completion\", \"created\": 1770618767, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you with your medical questions today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 13, \"total_tokens\": 40, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T06:32:50.775833Z", "step": "CHAT_SAVED", "message": "Chat request and response saved to DB", "request_id": "8c3bf9d7-724d-43f6-9e4a-1cf17449e188"}

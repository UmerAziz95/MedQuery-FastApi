{"timestamp": "2026-02-09T06:32:43.824320Z", "step": "CHAT_REQUEST_RECEIVED", "message": "Chat /generate request received", "business_client_id": "default", "workspace_id": "main", "user_id": "u123", "query": "hi"}
{"timestamp": "2026-02-09T06:32:43.834005Z", "step": "CHAT_BUSINESS_FOUND", "message": "Business resolved", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55"}
{"timestamp": "2026-02-09T06:32:43.863962Z", "step": "CHAT_WORKSPACE_FOUND", "message": "Workspace resolved", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5"}
{"timestamp": "2026-02-09T06:32:43.886383Z", "step": "CHAT_CONFIG_FOUND", "message": "Workspace config loaded", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "chat_model": "gpt-4.1-mini"}
{"timestamp": "2026-02-09T06:32:43.909835Z", "step": "CHAT_QUERY_RECEIVED", "message": "Query received in system", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5", "user_id": "u123", "query": "hi", "query_word_count": 1}
{"timestamp": "2026-02-09T06:32:43.939826Z", "step": "CHAT_EMBEDDING_START", "message": "Creating query embedding", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "use_local": true}
{"timestamp": "2026-02-09T06:32:49.528246Z", "step": "CHAT_EMBEDDING_DONE", "message": "Query vector created", "vector_dim": 384, "vector_preview": [-0.090476, 0.04044, 0.023906, 0.058948, -0.022882, -0.04722, 0.045048, 0.015786]}
{"timestamp": "2026-02-09T06:32:49.540209Z", "step": "CHAT_RETRIEVAL_START", "message": "Searching RAG for matching chunks", "top_k": 5, "similarity_threshold": 0.2}
{"timestamp": "2026-02-09T06:32:49.566451Z", "step": "CHAT_RETRIEVAL_DONE", "message": "Matched 0 chunks", "chunk_count": 0, "chunk_ids": [], "chunks_matched": []}
{"timestamp": "2026-02-09T06:32:49.579237Z", "step": "CHAT_PROMPT_BUILT", "message": "Final prompt assembled for ChatGPT API", "system_prompt_len": 53, "context_len": 0, "user_content_len": 23, "prompt_preview": "[SYSTEM]\nYou are a medical assistant. Provide concise answers.\n[USER]\nCONTEXT:\n\n\nQUESTION:\nhi"}
{"timestamp": "2026-02-09T06:32:49.595120Z", "step": "CHAT_OPENAI_CALL", "message": "Calling ChatGPT API (model=gpt-4.1-mini)", "model": "gpt-4.1-mini", "temperature": 0.2, "max_tokens": 600, "message_count": 2, "request_content_len": 76}
{"timestamp": "2026-02-09T06:32:49.611179Z", "step": "CHAT_OPENAI_KEY_CHECK", "message": "OpenAI API key from env/settings (masked)", "key_set": true, "key_length": 164, "masked_key": "sk-proj...YFkA"}
{"timestamp": "2026-02-09T06:32:49.643554Z", "step": "CHAT_OPENAI_SEND", "message": "Sending request to OpenAI", "model": "gpt-4.1-mini", "base_url": "https://api.openai.com/v1", "request_body": "{\"model\": \"gpt-4.1-mini\", \"message_count\": 2, \"temperature\": 0.2, \"max_tokens\": 600, \"message_content_lens\": [53, 23]}"}
{"timestamp": "2026-02-09T06:32:50.695875Z", "step": "CHAT_OPENAI_API_RESPONSE", "message": "OpenAI API raw response (before raise_for_status)", "status_code": 200, "response_body": "{\n  \"id\": \"chatcmpl-D7F79QTBxa176dvrLE0NGd6b37O1H\",\n  \"object\": \"chat.completion\",\n  \"created\": 1770618767,\n  \"model\": \"gpt-4.1-mini-2025-04-14\",\n  \"choices\": [\n    {\n      \"index\": 0,\n      \"message\": {\n        \"role\": \"assistant\",\n        \"content\": \"Hello! How can I assist you with your medical questions today?\",\n        \"refusal\": null,\n        \"annotations\": []\n      },\n      \"logprobs\": null,\n      \"finish_reason\": \"stop\"\n    }\n  ],\n  \"usage\": {\n    \"prompt_tokens\": 27,\n    \"completion_tokens\": 13,\n    \"total_tokens\": 40,\n    \"prompt_tokens_details\": {\n      \"cached_tokens\": 0,\n      \"audio_tokens\": 0\n    },\n    \"completion_tokens_details\": {\n      \"reasoning_tokens\": 0,\n      \"audio_tokens\": 0,\n      \"accepted_prediction_tokens\": 0,\n      \"rejected_prediction_tokens\": 0\n    }\n  },\n  \"service_tier\": \"default\",\n  \"system_fingerprint\": \"fp_75546bd1a7\"\n}\n"}
{"timestamp": "2026-02-09T06:32:50.708952Z", "step": "CHAT_OPENAI_RAW_RESPONSE", "message": "OpenAI API raw response body (success)", "raw_response": "{\"id\": \"chatcmpl-D7F79QTBxa176dvrLE0NGd6b37O1H\", \"object\": \"chat.completion\", \"created\": 1770618767, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you with your medical questions today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 13, \"total_tokens\": 40, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T06:32:50.738374Z", "step": "CHAT_OPENAI_RESPONSE", "message": "GPT response received", "answer_preview": "Hello! How can I assist you with your medical questions today?", "full_answer": "Hello! How can I assist you with your medical questions today?", "answer_len": 62, "prompt_tokens": 27, "completion_tokens": 13, "total_tokens": 40, "raw_response": "{\"id\": \"chatcmpl-D7F79QTBxa176dvrLE0NGd6b37O1H\", \"object\": \"chat.completion\", \"created\": 1770618767, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you with your medical questions today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 13, \"total_tokens\": 40, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T06:32:50.775833Z", "step": "CHAT_SAVED", "message": "Chat request and response saved to DB", "request_id": "8c3bf9d7-724d-43f6-9e4a-1cf17449e188"}
{"timestamp": "2026-02-09T07:50:04.154811Z", "step": "CHAT_REQUEST_RECEIVED", "message": "Chat /generate request received", "business_client_id": "default", "workspace_id": "main", "user_id": "u123", "query": "hi"}
{"timestamp": "2026-02-09T07:50:04.183241Z", "step": "CHAT_BUSINESS_FOUND", "message": "Business resolved", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55"}
{"timestamp": "2026-02-09T07:50:04.205960Z", "step": "CHAT_WORKSPACE_FOUND", "message": "Workspace resolved", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5"}
{"timestamp": "2026-02-09T07:50:04.230344Z", "step": "CHAT_CONFIG_FOUND", "message": "Workspace config loaded", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "chat_model": "gpt-4.1-mini"}
{"timestamp": "2026-02-09T07:50:04.243974Z", "step": "CHAT_QUERY_RECEIVED", "message": "Query received in system", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5", "user_id": "u123", "query": "hi", "query_word_count": 1}
{"timestamp": "2026-02-09T07:50:04.261228Z", "step": "CHAT_EMBEDDING_START", "message": "Creating query embedding", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "use_local": true}
{"timestamp": "2026-02-09T07:50:09.327457Z", "step": "CHAT_EMBEDDING_DONE", "message": "Query vector created", "vector_dim": 384, "vector_preview": [-0.090476, 0.04044, 0.023906, 0.058948, -0.022882, -0.04722, 0.045048, 0.015786]}
{"timestamp": "2026-02-09T07:50:09.336231Z", "step": "CHAT_RETRIEVAL_START", "message": "Searching RAG for matching chunks", "top_k": 5, "similarity_threshold": 0.2}
{"timestamp": "2026-02-09T07:50:09.389429Z", "step": "CHAT_RETRIEVAL_DONE", "message": "Matched 0 chunks", "chunk_count": 0, "chunk_ids": [], "chunks_matched": []}
{"timestamp": "2026-02-09T07:50:09.392424Z", "step": "CHAT_PROMPT_BUILT", "message": "Final prompt assembled for ChatGPT API", "system_prompt_len": 53, "context_len": 0, "user_content_len": 23, "prompt_preview": "[SYSTEM]\nYou are a medical assistant. Provide concise answers.\n[USER]\nCONTEXT:\n\n\nQUESTION:\nhi"}
{"timestamp": "2026-02-09T07:50:09.410195Z", "step": "CHAT_OPENAI_CALL", "message": "Calling ChatGPT API (model=gpt-4.1-mini)", "model": "gpt-4.1-mini", "temperature": 0.2, "max_tokens": 600, "message_count": 2, "request_content_len": 76}
{"timestamp": "2026-02-09T07:50:09.434104Z", "step": "CHAT_OPENAI_KEY_CHECK", "message": "OpenAI API key from env/settings (masked)", "key_set": false, "key_length": 0, "masked_key": "(empty or not set)"}
{"timestamp": "2026-02-09T07:51:26.129834Z", "step": "CHAT_REQUEST_RECEIVED", "message": "Chat /generate request received", "business_client_id": "default", "workspace_id": "main", "user_id": "u123", "query": "hi"}
{"timestamp": "2026-02-09T07:51:26.139680Z", "step": "CHAT_BUSINESS_FOUND", "message": "Business resolved", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55"}
{"timestamp": "2026-02-09T07:51:26.161845Z", "step": "CHAT_WORKSPACE_FOUND", "message": "Workspace resolved", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5"}
{"timestamp": "2026-02-09T07:51:26.183466Z", "step": "CHAT_CONFIG_FOUND", "message": "Workspace config loaded", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "chat_model": "gpt-4.1-mini"}
{"timestamp": "2026-02-09T07:51:26.201415Z", "step": "CHAT_QUERY_RECEIVED", "message": "Query received in system", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5", "user_id": "u123", "query": "hi", "query_word_count": 1}
{"timestamp": "2026-02-09T07:51:26.220168Z", "step": "CHAT_EMBEDDING_START", "message": "Creating query embedding", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "use_local": true}
{"timestamp": "2026-02-09T07:51:31.514723Z", "step": "CHAT_EMBEDDING_DONE", "message": "Query vector created", "vector_dim": 384, "vector_preview": [-0.090476, 0.04044, 0.023906, 0.058948, -0.022882, -0.04722, 0.045048, 0.015786]}
{"timestamp": "2026-02-09T07:51:31.520817Z", "step": "CHAT_RETRIEVAL_START", "message": "Searching RAG for matching chunks", "top_k": 5, "similarity_threshold": 0.2}
{"timestamp": "2026-02-09T07:51:31.617773Z", "step": "CHAT_RETRIEVAL_DONE", "message": "Matched 0 chunks", "chunk_count": 0, "chunk_ids": [], "chunks_matched": []}
{"timestamp": "2026-02-09T07:51:31.621847Z", "step": "CHAT_PROMPT_BUILT", "message": "Final prompt assembled for ChatGPT API", "system_prompt_len": 53, "context_len": 0, "user_content_len": 23, "prompt_preview": "[SYSTEM]\nYou are a medical assistant. Provide concise answers.\n[USER]\nCONTEXT:\n\n\nQUESTION:\nhi"}
{"timestamp": "2026-02-09T07:51:31.642781Z", "step": "CHAT_OPENAI_CALL", "message": "Calling ChatGPT API (model=gpt-4.1-mini)", "model": "gpt-4.1-mini", "temperature": 0.2, "max_tokens": 600, "message_count": 2, "request_content_len": 76}
{"timestamp": "2026-02-09T07:51:31.663167Z", "step": "CHAT_OPENAI_KEY_CHECK", "message": "OpenAI API key from env/settings (masked)", "key_set": true, "key_length": 164, "masked_key": "sk-proj...YFkA"}
{"timestamp": "2026-02-09T07:51:31.700608Z", "step": "CHAT_OPENAI_SEND", "message": "Sending request to OpenAI", "model": "gpt-4.1-mini", "base_url": "https://api.openai.com/v1", "request_body": "{\"model\": \"gpt-4.1-mini\", \"message_count\": 2, \"temperature\": 0.2, \"max_tokens\": 600, \"message_content_lens\": [53, 23]}"}
{"timestamp": "2026-02-09T07:51:33.152972Z", "step": "CHAT_OPENAI_API_RESPONSE", "message": "OpenAI API raw response (before raise_for_status)", "status_code": 200, "response_body": "{\n  \"id\": \"chatcmpl-D7GLK7FkS4iiGbDY2KLcJ1dNNoWQr\",\n  \"object\": \"chat.completion\",\n  \"created\": 1770623490,\n  \"model\": \"gpt-4.1-mini-2025-04-14\",\n  \"choices\": [\n    {\n      \"index\": 0,\n      \"message\": {\n        \"role\": \"assistant\",\n        \"content\": \"Hello! How can I assist you with your medical questions today?\",\n        \"refusal\": null,\n        \"annotations\": []\n      },\n      \"logprobs\": null,\n      \"finish_reason\": \"stop\"\n    }\n  ],\n  \"usage\": {\n    \"prompt_tokens\": 27,\n    \"completion_tokens\": 13,\n    \"total_tokens\": 40,\n    \"prompt_tokens_details\": {\n      \"cached_tokens\": 0,\n      \"audio_tokens\": 0\n    },\n    \"completion_tokens_details\": {\n      \"reasoning_tokens\": 0,\n      \"audio_tokens\": 0,\n      \"accepted_prediction_tokens\": 0,\n      \"rejected_prediction_tokens\": 0\n    }\n  },\n  \"service_tier\": \"default\",\n  \"system_fingerprint\": \"fp_75546bd1a7\"\n}\n"}
{"timestamp": "2026-02-09T07:51:33.159936Z", "step": "CHAT_OPENAI_RAW_RESPONSE", "message": "OpenAI API raw response body (success)", "raw_response": "{\"id\": \"chatcmpl-D7GLK7FkS4iiGbDY2KLcJ1dNNoWQr\", \"object\": \"chat.completion\", \"created\": 1770623490, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you with your medical questions today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 13, \"total_tokens\": 40, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T07:51:33.184330Z", "step": "CHAT_OPENAI_RESPONSE", "message": "GPT response received", "answer_preview": "Hello! How can I assist you with your medical questions today?", "full_answer": "Hello! How can I assist you with your medical questions today?", "answer_len": 62, "prompt_tokens": 27, "completion_tokens": 13, "total_tokens": 40, "raw_response": "{\"id\": \"chatcmpl-D7GLK7FkS4iiGbDY2KLcJ1dNNoWQr\", \"object\": \"chat.completion\", \"created\": 1770623490, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you with your medical questions today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 13, \"total_tokens\": 40, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T07:51:33.241407Z", "step": "CHAT_SAVED", "message": "Chat request and response saved to DB", "request_id": "6fef8c04-1e61-4bc5-a0a3-80f4ca970025"}
{"timestamp": "2026-02-09T08:00:38.652730Z", "step": "CHAT_REQUEST_RECEIVED", "message": "Chat /generate request received", "business_client_id": "default", "workspace_id": "main", "user_id": "u123", "query": "hi"}
{"timestamp": "2026-02-09T08:00:38.665597Z", "step": "CHAT_BUSINESS_FOUND", "message": "Business resolved", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55"}
{"timestamp": "2026-02-09T08:00:38.687955Z", "step": "CHAT_WORKSPACE_FOUND", "message": "Workspace resolved", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5"}
{"timestamp": "2026-02-09T08:00:38.713203Z", "step": "CHAT_CONFIG_FOUND", "message": "Workspace config loaded", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "chat_model": "gpt-4.1-mini"}
{"timestamp": "2026-02-09T08:00:38.733209Z", "step": "CHAT_QUERY_RECEIVED", "message": "Query received in system", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5", "user_id": "u123", "query": "hi", "query_word_count": 1}
{"timestamp": "2026-02-09T08:00:38.760439Z", "step": "CHAT_EMBEDDING_START", "message": "Creating query embedding", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "use_local": true}
{"timestamp": "2026-02-09T08:01:02.032965Z", "step": "CHAT_EMBEDDING_DONE", "message": "Query vector created", "vector_dim": 384, "vector_preview": [-0.090476, 0.04044, 0.023906, 0.058948, -0.022882, -0.04722, 0.045048, 0.015786]}
{"timestamp": "2026-02-09T08:01:02.041164Z", "step": "CHAT_RETRIEVAL_START", "message": "Searching RAG for matching chunks", "top_k": 5, "similarity_threshold": 0.2}
{"timestamp": "2026-02-09T08:01:02.146509Z", "step": "CHAT_RETRIEVAL_DONE", "message": "Matched 0 chunks", "chunk_count": 0, "chunk_ids": [], "chunks_matched": []}
{"timestamp": "2026-02-09T08:01:02.153134Z", "step": "CHAT_PROMPT_BUILT", "message": "Final prompt assembled for ChatGPT API", "system_prompt_len": 53, "context_len": 0, "user_content_len": 23, "prompt_preview": "[SYSTEM]\nYou are a medical assistant. Provide concise answers.\n[USER]\nCONTEXT:\n\n\nQUESTION:\nhi"}
{"timestamp": "2026-02-09T08:01:02.186493Z", "step": "CHAT_OPENAI_CALL", "message": "Calling ChatGPT API (model=gpt-4.1-mini)", "model": "gpt-4.1-mini", "temperature": 0.2, "max_tokens": 600, "message_count": 2, "request_content_len": 76}
{"timestamp": "2026-02-09T08:01:02.221327Z", "step": "CHAT_OPENAI_KEY_CHECK", "message": "OpenAI API key from env/settings (masked)", "key_set": true, "key_length": 164, "masked_key": "sk-proj...YFkA"}
{"timestamp": "2026-02-09T08:01:02.280792Z", "step": "CHAT_OPENAI_SEND", "message": "Sending request to OpenAI", "model": "gpt-4.1-mini", "base_url": "https://api.openai.com/v1", "request_body": "{\"model\": \"gpt-4.1-mini\", \"message_count\": 2, \"temperature\": 0.2, \"max_tokens\": 600, \"message_content_lens\": [53, 23]}"}
{"timestamp": "2026-02-09T08:01:03.449794Z", "step": "CHAT_OPENAI_API_RESPONSE", "message": "OpenAI API raw response (before raise_for_status)", "status_code": 200, "response_body": "{\n  \"id\": \"chatcmpl-D7GUWVlGPDzjLDWAD1kJ8G4AroJMh\",\n  \"object\": \"chat.completion\",\n  \"created\": 1770624060,\n  \"model\": \"gpt-4.1-mini-2025-04-14\",\n  \"choices\": [\n    {\n      \"index\": 0,\n      \"message\": {\n        \"role\": \"assistant\",\n        \"content\": \"Hello! How can I assist you today?\",\n        \"refusal\": null,\n        \"annotations\": []\n      },\n      \"logprobs\": null,\n      \"finish_reason\": \"stop\"\n    }\n  ],\n  \"usage\": {\n    \"prompt_tokens\": 27,\n    \"completion_tokens\": 9,\n    \"total_tokens\": 36,\n    \"prompt_tokens_details\": {\n      \"cached_tokens\": 0,\n      \"audio_tokens\": 0\n    },\n    \"completion_tokens_details\": {\n      \"reasoning_tokens\": 0,\n      \"audio_tokens\": 0,\n      \"accepted_prediction_tokens\": 0,\n      \"rejected_prediction_tokens\": 0\n    }\n  },\n  \"service_tier\": \"default\",\n  \"system_fingerprint\": \"fp_75546bd1a7\"\n}\n"}
{"timestamp": "2026-02-09T08:01:03.458650Z", "step": "CHAT_OPENAI_RAW_RESPONSE", "message": "OpenAI API raw response body (success)", "raw_response": "{\"id\": \"chatcmpl-D7GUWVlGPDzjLDWAD1kJ8G4AroJMh\", \"object\": \"chat.completion\", \"created\": 1770624060, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 9, \"total_tokens\": 36, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T08:01:03.482827Z", "step": "CHAT_OPENAI_RESPONSE", "message": "GPT response received", "answer_preview": "Hello! How can I assist you today?", "full_answer": "Hello! How can I assist you today?", "answer_len": 34, "prompt_tokens": 27, "completion_tokens": 9, "total_tokens": 36, "raw_response": "{\"id\": \"chatcmpl-D7GUWVlGPDzjLDWAD1kJ8G4AroJMh\", \"object\": \"chat.completion\", \"created\": 1770624060, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 9, \"total_tokens\": 36, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T08:01:03.518110Z", "step": "CHAT_SAVED", "message": "Chat request and response saved to DB", "request_id": "3b397569-3e97-4201-b793-56ac471d9913"}
{"timestamp": "2026-02-09T08:13:25.170818Z", "step": "CHAT_REQUEST_RECEIVED", "message": "Chat /generate request received", "business_client_id": "default", "workspace_id": "main", "user_id": "u123", "query": "hi"}
{"timestamp": "2026-02-09T08:13:25.188102Z", "step": "CHAT_BUSINESS_FOUND", "message": "Business resolved", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55"}
{"timestamp": "2026-02-09T08:13:25.223981Z", "step": "CHAT_WORKSPACE_FOUND", "message": "Workspace resolved", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5"}
{"timestamp": "2026-02-09T08:13:25.252761Z", "step": "CHAT_CONFIG_FOUND", "message": "Workspace config loaded", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "chat_model": "gpt-4.1-mini"}
{"timestamp": "2026-02-09T08:13:25.270992Z", "step": "CHAT_QUERY_RECEIVED", "message": "Query received in system", "business_id": "9732ad9b-720e-4f7e-8436-d1d0302e4e55", "workspace_id": "b67ee4ec-1594-4d1b-832c-fcb235b97cf5", "user_id": "u123", "query": "hi", "query_word_count": 1}
{"timestamp": "2026-02-09T08:13:25.299350Z", "step": "CHAT_EMBEDDING_START", "message": "Creating query embedding", "embedding_model": "sentence-transformers/all-MiniLM-L6-v2", "use_local": true}
{"timestamp": "2026-02-09T08:13:47.557762Z", "step": "CHAT_EMBEDDING_DONE", "message": "Query vector created", "vector_dim": 384, "vector_preview": [-0.090476, 0.04044, 0.023906, 0.058948, -0.022882, -0.04722, 0.045048, 0.015786]}
{"timestamp": "2026-02-09T08:13:47.563261Z", "step": "CHAT_RETRIEVAL_START", "message": "Searching RAG for matching chunks", "top_k": 5, "similarity_threshold": 0.2}
{"timestamp": "2026-02-09T08:13:47.692574Z", "step": "CHAT_RETRIEVAL_DONE", "message": "Matched 0 chunks", "chunk_count": 0, "chunk_ids": [], "chunks_matched": []}
{"timestamp": "2026-02-09T08:13:47.702142Z", "step": "CHAT_PROMPT_BUILT", "message": "Final prompt assembled for ChatGPT API", "system_prompt_len": 53, "context_len": 0, "user_content_len": 23, "prompt_preview": "[SYSTEM]\nYou are a medical assistant. Provide concise answers.\n[USER]\nCONTEXT:\n\n\nQUESTION:\nhi"}
{"timestamp": "2026-02-09T08:13:47.742544Z", "step": "CHAT_OPENAI_CALL", "message": "Calling ChatGPT API (model=gpt-4.1-mini)", "model": "gpt-4.1-mini", "temperature": 0.2, "max_tokens": 600, "message_count": 2, "request_content_len": 76}
{"timestamp": "2026-02-09T08:13:47.768107Z", "step": "CHAT_OPENAI_KEY_CHECK", "message": "OpenAI API key from env/settings (masked)", "key_set": true, "key_length": 164, "masked_key": "sk-proj...YFkA"}
{"timestamp": "2026-02-09T08:13:47.803914Z", "step": "CHAT_OPENAI_SEND", "message": "Sending request to OpenAI", "model": "gpt-4.1-mini", "base_url": "https://api.openai.com/v1", "request_body": "{\"model\": \"gpt-4.1-mini\", \"message_count\": 2, \"temperature\": 0.2, \"max_tokens\": 600, \"message_content_lens\": [53, 23]}"}
{"timestamp": "2026-02-09T08:13:49.476040Z", "step": "CHAT_OPENAI_API_RESPONSE", "message": "OpenAI API raw response (before raise_for_status)", "status_code": 200, "response_body": "{\n  \"id\": \"chatcmpl-D7GgsXdcLZFjEN147Bvax1SZF2s4c\",\n  \"object\": \"chat.completion\",\n  \"created\": 1770624826,\n  \"model\": \"gpt-4.1-mini-2025-04-14\",\n  \"choices\": [\n    {\n      \"index\": 0,\n      \"message\": {\n        \"role\": \"assistant\",\n        \"content\": \"Hello! How can I assist you today?\",\n        \"refusal\": null,\n        \"annotations\": []\n      },\n      \"logprobs\": null,\n      \"finish_reason\": \"stop\"\n    }\n  ],\n  \"usage\": {\n    \"prompt_tokens\": 27,\n    \"completion_tokens\": 9,\n    \"total_tokens\": 36,\n    \"prompt_tokens_details\": {\n      \"cached_tokens\": 0,\n      \"audio_tokens\": 0\n    },\n    \"completion_tokens_details\": {\n      \"reasoning_tokens\": 0,\n      \"audio_tokens\": 0,\n      \"accepted_prediction_tokens\": 0,\n      \"rejected_prediction_tokens\": 0\n    }\n  },\n  \"service_tier\": \"default\",\n  \"system_fingerprint\": \"fp_75546bd1a7\"\n}\n"}
{"timestamp": "2026-02-09T08:13:49.484866Z", "step": "CHAT_OPENAI_RAW_RESPONSE", "message": "OpenAI API raw response body (success)", "raw_response": "{\"id\": \"chatcmpl-D7GgsXdcLZFjEN147Bvax1SZF2s4c\", \"object\": \"chat.completion\", \"created\": 1770624826, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 9, \"total_tokens\": 36, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T08:13:49.522593Z", "step": "CHAT_OPENAI_RESPONSE", "message": "GPT response received", "answer_preview": "Hello! How can I assist you today?", "full_answer": "Hello! How can I assist you today?", "answer_len": 34, "prompt_tokens": 27, "completion_tokens": 9, "total_tokens": 36, "raw_response": "{\"id\": \"chatcmpl-D7GgsXdcLZFjEN147Bvax1SZF2s4c\", \"object\": \"chat.completion\", \"created\": 1770624826, \"model\": \"gpt-4.1-mini-2025-04-14\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Hello! How can I assist you today?\", \"refusal\": null, \"annotations\": []}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 27, \"completion_tokens\": 9, \"total_tokens\": 36, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"service_tier\": \"default\", \"system_fingerprint\": \"fp_75546bd1a7\"}"}
{"timestamp": "2026-02-09T08:13:49.593162Z", "step": "CHAT_SAVED", "message": "Chat request and response saved to DB", "request_id": "a8d57a0f-2d08-4b9b-8382-6d9b6856a980"}
